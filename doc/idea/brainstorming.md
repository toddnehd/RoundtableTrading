# 멀티 에이전틱 주식 트레이딩 서비스 - 브레인스토밍

> 이 문서는 idea.md의 초기 아이디어를 확장하고 구체화한 브레인스토밍 결과입니다.
> 추후 PRD, roadmap, architecture 문서로 정리될 예정입니다.

---

## 1. 확장된 에이전트 아키텍처

### 기존 에이전트 (idea.md)
1. **기업 가치 분석 에이전트**: 펀더멘털, 재무제표, 밸류에이션, 미래 성장성, 기업 뉴스
2. **테마/섹터 특화 에이전트**: 업종별, 섹터별 특화 분석
3. **시장 분석 에이전트**: 실시간 뉴스, 환율, 지표, 국내외 시장 변화 예측
4. **기술적 분석 에이전트**: 모멘텀, 거래량, 수급, 차트, 기술적 지표

### 제안 추가 에이전트

#### 5. 리스크 관리자 에이전트
**역할**: 포트폴리오 위험도 모니터링 및 손절 판단
- 포트폴리오 전체 위험도 실시간 계산
- VaR(Value at Risk) 기반 포지션 크기 조절
- 손절 시점 판단 (개별 종목 + 전체 포트폴리오)
- 시장 변동성 감지 및 방어 모드 전환
- 블랙스완 이벤트 대응 프로토콜

**핵심 지표**:
- 포트폴리오 베타, 샤프 비율
- 최대 낙폭(MDD) 모니터링
- 섹터별 분산도
- 개별 종목 손실 한계선

#### 6. 심리 분석 에이전트
**역할**: 시장 심리 및 투자 감성 분석
- 공포/탐욕 지수 분석
- 커뮤니티 감성 분석 (주식 갤러리, 네이버 증권 댓글)
- 기관/외국인 수급 패턴 분석
- 투자자 행동 패턴 감지 (패닉 셀, FOMO 매수 등)

**데이터 소스**:
- SNS, 커뮤니티 크롤링
- 뉴스 헤드라인 감성 분석
- 거래량/거래대금 급증 감지

#### 7. 이벤트 트래커 에이전트
**역할**: 주요 이벤트 포착 및 기회 발굴
- 공시 실시간 모니터링 (유상증자, M&A, 배당 등)
- 배당락일, 실적 발표일 추적
- 정부 정책 변화 감지
- 산업 이벤트 (반도체 수출 통계, 유가 변동 등)

**활용**:
- 이벤트 드리븐 매매 기회 포착
- 리스크 이벤트 사전 경고

#### 8. 백테스팅 검증자 에이전트
**역할**: 전략 검증 및 성과 분석
- 과거 데이터 기반 전략 검증
- Out-of-sample 테스트로 과적합 방지
- Walk-forward 분석으로 전략 유효성 검증
- 거래 비용(수수료, 세금, 슬리피지) 반영한 현실적 성과 계산

**출력**:
- 연 수익률, 샤프 비율, MDD
- 승률, 평균 수익/손실 비율
- 전략 강점/약점 분석

#### 9. 조정자(Moderator) 에이전트
**역할**: 에이전트 간 의견 조율 및 최종 의사결정
- 각 에이전트의 의견 취합
- 가중치 기반 종합 판단
- 이견이 큰 경우 추가 토론 유도
- 최종 매매 결정 및 파라미터 도출 (진입가, 목표가, 손절가)

**의사결정 알고리즘**:
- 신뢰도 기반 가중 투표
- 과거 성과 반영한 동적 가중치 조정
- 합의 임계값 설정 (예: 70% 이상 동의 시 실행)

---

## 2. 에이전트 간 토론 메커니즘

### 토론 프로토콜 (5단계)

```
┌─────────────────────────────────────────────────────────┐
│ 1. 개별 분석 단계                                        │
│ - 각 에이전트가 독립적으로 분석                          │
│ - 자신의 전문 영역에서 의견 도출                         │
│ - 신뢰도 점수 부여 (0-100)                              │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│ 2. 의견 제시 단계                                        │
│ - 점수화된 의견 제출                                     │
│   예: 매수(85점), 중립(60점), 매도(30점)                │
│ - 근거 제시 (핵심 팩트 3개)                             │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│ 3. 토론 라운드 (필요시)                                  │
│ - 의견 편차가 큰 경우 (표준편차 > 임계값)               │
│ - 각 에이전트가 서로의 의견에 반박/지지                 │
│ - 추가 데이터 요청 및 재분석 기회                       │
│ - 최대 3라운드까지 진행                                  │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│ 4. 합의 도출 단계                                        │
│ - 가중 투표 (과거 성과 기반 가중치)                     │
│ - 최소 합의 임계값 확인 (예: 70%)                       │
│ - 합의 실패 시 → "판단 보류" 또는 "소량 진입"           │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│ 5. 최종 결정 (조정자)                                    │
│ - 종합 의견 정리                                         │
│ - 매수/매도/보유 결정                                    │
│ - 진입가, 목표가, 손절가 도출                           │
│ - 포지션 크기 결정 (신뢰도 반영)                        │
└─────────────────────────────────────────────────────────┘
```

### 토론 시각화 (투명성)
사용자에게 다음 정보를 제공:
- 각 에이전트의 의견 및 근거
- 토론 과정 전체 기록
- 반대 의견도 함께 표시
- 최종 결정의 신뢰도 점수
- "만약 X였다면 Y했을 것" 시나리오

**예시 출력**:
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
삼성전자(005930) 분석 결과
신뢰도: 87% | 최종 결정: 매수 추천
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✅ 찬성 (5명)
├─ 기업가치: 긍정 (92점)
│  └─ 근거: 실적 개선, PER 15 → 역사적 저평가
├─ 기술적: 긍정 (85점)
│  └─ 근거: 골든크로스, 거래량 증가
├─ 시장: 긍정 (78점)
│  └─ 근거: 반도체 업황 회복 신호
├─ 심리: 긍정 (80점)
│  └─ 근거: 외국인 순매수 3일 연속
└─ 이벤트: 긍정 (75점)
   └─ 근거: 배당 발표 임박

⚠️ 유보 (1명)
└─ 리스크관리: 중립 (65점)
   └─ 근거: 단기 과열 신호, RSI 70 근접

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
조정자 최종 판단
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
매수 추천: 70,000원
목표가: 78,000원 (+11.4%)
손절가: 66,000원 (-5.7%)
포지션: 총 자산의 15% (중간 신뢰도)

⚠️ 주의사항: 단기 과열 가능성 있음.
분할 매수 권장 (3회 나눠서)
```

---

## 3. 3단계 진화 전략

### Phase 1: 분석 보조 도구 (1-3개월)
**목표**: 에이전트 협업 검증 & 사용자 신뢰 구축
**핵심**: 추천은 하되, 실행은 사용자가

**주요 기능**:
- 종목 분석 리포트 생성
  - 5개+ 에이전트의 독립 분석
  - 토론 과정 시각화 (투명성)
  - 합의된 의견 + 신뢰도 점수
- 매수/매도 신호 알림
  - 진입가, 목표가, 손절가 제안
  - 근거 상세 설명
- 백테스팅 결과 공유
  - 과거 3년 데이터로 전략 검증
  - 현실적인 성과 계산 (수수료, 세금 포함)

**성공 지표**:
- 백테스팅 샤프 비율 > 1.5
- 추천 종목의 2주 후 승률 > 60%
- 사용자 만족도 (추천 신뢰 여부)

---

### Phase 2: 반자동 매매 (3-6개월)
**목표**: 실전 검증 & 전략 최적화
**핵심**: 사용자 승인 하에 자동 실행

**주요 기능**:
- 시뮬레이션 계좌
  - 가상 1억으로 실전 연습
  - 실시간 성과 트래킹
- 승인 기반 자동매매
  - 에이전트 추천 → 사용자 승인 → 자동 주문
  - 긴급 손절은 자동 실행 (사전 동의)
  - 일일 리포트 (오늘의 결정 & 성과)
- 전략 학습 시스템
  - 성과 좋은 에이전트 가중치 증가
  - 실패 패턴 분석 & 개선

**위험 관리**:
- 일일 거래 한도 설정 (예: 총 자산의 5%)
- 단일 종목 최대 비중 제한 (20%)
- 사용자가 언제든 개입 가능
- 소액 실전 테스트 (100만원 ~ 500만원)

**성공 지표**:
- 시뮬레이션 계좌 월 수익률 > 시장 수익률
- 실계좌 테스트 MDD < 10%
- 자동 손절/익절 정확도 > 80%

---

### Phase 3: 완전 자동매매 (6개월+)
**목표**: 수익 창출 시스템
**핵심**: 24시간 자율 운영

**주요 기능**:
- 완전 자율 매매
  - 장 시작 전 포트폴리오 재조정
  - 장중 실시간 모니터링 & 대응
  - 포지션 관리 (익절/손절 자동)
- 고도화된 리스크 관리
  - VaR 기반 포지션 크기 결정
  - 시장 변동성 감지 → 자동 방어 모드
  - 블랙스완 이벤트 대응 프로토콜
- 멀티 전략 운영
  - 단타 전략 (데이트레이딩)
  - 스윙 전략 (3-10일)
  - 모멘텀 전략 (테마주)
- 성과 분석 & 보고
  - 주간/월간 성과 리포트
  - 에이전트별 기여도 분석
  - 지속적인 전략 최적화

**성공 지표**:
- 연 수익률 > 15% (KOSPI 대비 초과 수익)
- 샤프 비율 > 2.0
- MDD < 15%
- 승률 > 55%

---

## 4. 기술 스택 후보

### Backend
- **Python (FastAPI 또는 Django)**
  - 메인 API 서버
  - RESTful API + WebSocket (실시간 업데이트)
- **Redis**
  - 실시간 시세 데이터 캐싱
  - 에이전트 상태 관리
- **PostgreSQL**
  - 거래 기록, 포트폴리오 히스토리
  - 에이전트 의견 저장 (토론 기록)
- **TimescaleDB** (옵션)
  - 시계열 데이터 최적화

### AI/Agent Framework
- **LangGraph 또는 AutoGen**
  - 멀티 에이전트 오케스트레이션
  - 에이전트 간 통신 및 토론 관리
- **Claude API (Anthropic)**
  - 각 에이전트의 추론 엔진
  - 긴 컨텍스트 활용 (200K tokens)
- **scikit-learn / PyTorch** (옵션)
  - 기술적 지표 예측 모델
  - 가격 패턴 인식

### Data Sources
- **pykrx**
  - 과거 주가, 재무제표, 수급 데이터
- **증권사 OpenAPI**
  - 실시간 시세 조회
  - 주문 실행 (한국투자증권, 키움증권 등)
- **Web Scraping**
  - 뉴스 크롤링
  - 커뮤니티 감성 분석 (주식 갤러리 등)

### MCP Integration
- **증권사 OpenAPI MCP 서버**
  - 에이전트가 사용할 수 있는 도구로 래핑
  - 기능: 시세 조회, 주문, 잔고 확인, 체결 내역 등

### Frontend (옵션)
- **React 또는 Vue**
  - 웹 대시보드
  - 실시간 차트 및 토론 과정 시각화
- **Streamlit** (빠른 프로토타입)
  - Python 기반 대시보드
  - 초기 MVP에 적합

### Monitoring & Logging
- **Prometheus + Grafana**
  - 시스템 성능 모니터링
  - 거래 성과 대시보드
- **ELK Stack** (옵션)
  - 로그 수집 및 분석

---

## 5. 아키텍처 개요 (초안)

```
RoundtableTrading/
│
├─ agents/                      # 에이전트 모듈
│  ├─ base_agent.py            # 베이스 에이전트 클래스
│  ├─ fundamental.py           # 기업 가치 분석
│  ├─ technical.py             # 차트/지표 분석
│  ├─ market_analyzer.py       # 시장/섹터 분석
│  ├─ news_sentiment.py        # 뉴스/감성 분석
│  ├─ risk_manager.py          # 리스크 관리
│  ├─ psychology.py            # 심리 분석
│  ├─ event_tracker.py         # 이벤트 추적
│  ├─ backtester.py            # 백테스팅 검증
│  └─ moderator.py             # 조정자 (최종 의사결정)
│
├─ roundtable/                  # 토론 시스템
│  ├─ debate_engine.py         # 토론 오케스트레이션
│  ├─ consensus.py             # 합의 알고리즘
│  ├─ voting.py                # 가중 투표 시스템
│  └─ visualizer.py            # 토론 과정 시각화
│
├─ data/                        # 데이터 레이어
│  ├─ providers/
│  │  ├─ pykrx_client.py       # 과거 데이터 (pykrx)
│  │  ├─ broker_api.py         # 실시간 시세 (증권사 API)
│  │  ├─ news_scraper.py       # 뉴스 수집
│  │  └─ community_crawler.py  # 커뮤니티 크롤링
│  ├─ storage/
│  │  ├─ timeseries_db.py      # 시계열 데이터 관리
│  │  └─ cache_manager.py      # Redis 캐싱
│  └─ preprocessor.py          # 데이터 전처리
│
├─ trading/                     # 매매 실행
│  ├─ executor.py              # 주문 실행
│  ├─ portfolio.py             # 포트폴리오 관리
│  ├─ position_manager.py      # 포지션 관리
│  └─ risk_controls.py         # 리스크 제어 (한도, 손절 등)
│
├─ backtesting/                 # 백테스팅
│  ├─ simulator.py             # 과거 데이터 시뮬레이터
│  ├─ performance.py           # 성과 분석
│  └─ reports.py               # 리포트 생성
│
├─ api/                         # REST API
│  ├─ main.py                  # FastAPI 메인
│  ├─ endpoints/
│  │  ├─ analysis.py           # 분석 API
│  │  ├─ trading.py            # 매매 API
│  │  └─ portfolio.py          # 포트폴리오 API
│  └─ websocket.py             # 실시간 업데이트
│
├─ mcp/                         # MCP 서버
│  └─ broker_mcp.py            # 증권사 OpenAPI MCP 래퍼
│
├─ utils/                       # 유틸리티
│  ├─ logger.py                # 로깅
│  ├─ config.py                # 설정 관리
│  └─ metrics.py               # 성과 지표 계산
│
├─ tests/                       # 테스트
│  ├─ unit/
│  ├─ integration/
│  └─ e2e/
│
└─ docs/                        # 문서
   ├─ idea.md
   ├─ brainstorming.md
   ├─ prd.md                   # 제품 요구사항 (추후 생성)
   ├─ architecture.md          # 아키텍처 설계 (추후)
   └─ roadmap.md               # 개발 로드맵 (추후)
```

---

## 6. 핵심 성공 요소

### 6.1 투명성 (Transparency)
**중요성**: 사용자가 "왜 이 결정을 내렸는가"를 이해해야 신뢰 구축

**구현 방안**:
- 토론 과정 전체 기록 저장 및 공개
- 각 에이전트의 근거를 명확히 제시
- 반대 의견도 함께 표시
- "만약 X였다면 Y했을 것" 시나리오 제공
- 사용자가 언제든 과거 결정을 조회 가능

### 6.2 단계적 리스크 노출
**중요성**: 갑작스러운 손실로 인한 신뢰 붕괴 방지

**전략**:
- Phase 1: 0원 (분석만 제공)
- Phase 2: 소액 실전 (100만원 ~ 500만원)
- Phase 3: 본격 투자 (성과 검증 후)
- 각 단계마다 최소 2-3개월 검증 기간 필수

### 6.3 현실적인 백테스팅
**함정**: 과거 데이터로 100% 수익률 → 실전 폭망

**해결 방안**:
- **거래 비용 반영**: 수수료 0.015%, 세금 0.23%, 슬리피지 0.1%
- **유동성 제약 고려**: 대량 매수 시 가격 영향 반영
- **Out-of-sample 테스트**: 학습하지 않은 기간으로 검증
- **Walk-forward 분석**: 시간 흐름에 따른 전략 유효성 검증
- **과적합 방지**: 너무 복잡한 규칙은 피하기

### 6.4 리스크 관리의 중요성
**원칙**: "수익을 추구하기 전에, 먼저 손실을 방어하라"

**핵심 규칙**:
- 단일 종목 최대 투자 비중: 20%
- 일일 최대 손실 한도: -3%
- 섹터별 분산 투자 강제
- 변동성 기반 포지션 크기 조절
- 자동 손절 트리거 (개별 종목 -7%, 전체 포트폴리오 -10%)
- 급격한 시장 변동 시 방어 모드 (현금 비중 증가)

### 6.5 에이전트 학습 및 진화
**목표**: 시간이 지날수록 더 똑똑해지는 시스템

**방법**:
- 각 에이전트의 과거 추천 성과 추적
- 성과 좋은 에이전트의 가중치 자동 증가
- 실패한 패턴 분석 및 학습
- 시장 환경 변화 감지 및 전략 조정
- 정기적인 전략 리뷰 (월 1회)

### 6.6 MCP 서버 전략
**목적**: 증권사 API를 에이전트가 사용할 수 있는 도구로 제공

**도구 예시**:
```python
# 에이전트가 사용할 수 있는 도구들
tools = [
    "get_current_price(ticker)",          # 현재가 조회
    "get_orderbook(ticker)",              # 호가 조회
    "get_chart_data(ticker, period)",     # 차트 데이터
    "place_order(ticker, qty, price)",    # 주문
    "get_portfolio()",                    # 보유 종목
    "get_balance()",                      # 예수금
    "cancel_order(order_id)",             # 주문 취소
    "get_daily_pnl()",                    # 일일 손익
]
```

---

## 7. 향후 확장 가능성

### 7.1 다른 시장으로 확장
- 미국 주식 (S&P 500, NASDAQ)
- 암호화폐
- 선물/옵션
- 해외 지수 ETF

### 7.2 사용자 커스터마이징
- 에이전트 가중치 조절 (사용자가 선호하는 에이전트)
- 리스크 성향 설정 (보수적 / 공격적)
- 투자 테마 선택 (배당주, 성장주, 가치주 등)

### 7.3 소셜 기능
- 다른 사용자의 포트폴리오 참고
- 에이전트 토론 결과 공유
- 커뮤니티 투표로 종목 추천

### 7.4 수익화 전략
- **Phase 1-2**: 무료 (사용자 확보 & 검증)
- **Phase 3**:
  - 구독 모델: 월 9,900원 ~ 49,900원
  - 성과 연동: 수익의 10% 수수료 (성공 보수)
  - 프리미엄 전략: 고급 전략 별도 판매
  - 기업용 라이선스 (펀드, 자산운용사 대상)

---

## 8. 해결해야 할 주요 과제

### 8.1 기술적 과제
- [ ] 멀티 에이전트 간 효율적인 통신 프로토콜 설계
- [ ] 실시간 데이터 처리 성능 최적화
- [ ] LLM API 비용 최적화 (Claude API 호출 최소화)
- [ ] 백테스팅 엔진의 정확성 및 속도

### 8.2 금융 도메인 과제
- [ ] 현실적인 거래 비용 모델링
- [ ] 유동성 제약 반영
- [ ] 시장 충격 비용(Market Impact) 계산
- [ ] 극단적 시장 상황(블랙스완) 대응

### 8.3 법적/규제 과제
- [ ] 자동매매 관련 규제 확인
- [ ] 투자 조언 제공 시 법적 리스크
- [ ] 개인정보 보호 (계좌 정보 보안)
- [ ] 면책 조항 명확히

### 8.4 사용자 경험 과제
- [ ] 복잡한 토론 과정을 쉽게 이해할 수 있는 UI
- [ ] 실시간 알림 시스템 (너무 많으면 스팸)
- [ ] 사용자 신뢰 구축 (초기 단계)
- [ ] 손실 발생 시 사용자 이탈 방지

---

## 9. 다음 단계

### 즉시 결정 필요
1. **증권사 API 선택**: 한국투자증권 vs 키움증권 vs 기타
2. **에이전트 프레임워크**: LangGraph vs AutoGen vs 직접 구현
3. **MVP 범위 정의**: Phase 1에서 최소한으로 만들 기능

### 단기 (1-2주)
1. **PRD 작성**: idea.md + brainstorming.md 취합
2. **Architecture 설계**: 시스템 구조 상세 설계
3. **Roadmap 작성**: 개발 일정 및 마일스톤

### 중기 (1개월)
1. **Phase 1 MVP 개발**: 단일 종목 분석 시스템
2. **초기 에이전트 구현**: 기술적 분석 + 펀더멘털 분석
3. **백테스팅 엔진 구현**

---

## 10. 참고 자료 및 영감

### 유사 서비스
- **QuantConnect**: 알고리즘 트레이딩 플랫폼
- **Alpaca**: API 기반 자동매매
- **Trading View**: 차트 분석 및 전략 백테스팅

### 학습 자료
- **Algorithmic Trading**: Ernest P. Chan 저서
- **Machine Learning for Asset Managers**: Marcos Lopez de Prado
- **Korean Stock Market Data**: pykrx 문서

### AI Agent 프레임워크
- **LangGraph**: https://langchain-ai.github.io/langgraph/
- **AutoGen**: https://microsoft.github.io/autogen/
- **CrewAI**: https://www.crewai.io/

---

**마지막 업데이트**: 2026-01-21
